<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> تسجيل الدخول </title>
<link rel="stylesheet" href="style-login.css">
<link rel="stylesheet" href="midai.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body dir="rtl">

    <header class="header">
        <!-- <img src="img/shar.png" alt="logo" class="img-left"> -->

        <div class="logo">
            <img src="img/synchronisation.png" alt="logo" >

        </div>
    </header>

  <section class="section">
      <div class="log-All">

        <div class="img-scrool marg-midai">
            <img src="img/thdam.png" alt="">
        </div>

        <div class="img-point marg-midai">
            <h2></h2>
            <h2></h2>
            <h2></h2>
        </div>

        <div class="hello marg-midai">
            <p>اهلاً بك</p>
        </div>

                     <script src="https://unpkg.com/html5-qrcode"></script>
   <style>
     body { font-family: Arial, sans-serif; text-align:center; direction:rtl; }
     #reader { width: 300px; margin: 20px auto; }
     button {
      background-color: #007bff; color: white; border: none;
      padding: 10px 20px; font-size: 16px; border-radius: 5px;
       cursor: pointer; margin-top: 10px;
     }
     #result { font-weight: bold; margin-top: 15px; }
   </style>

   <h2>قراءة كود QR بالكاميرا</h2>
   <!-- <button id="startScan">ابدأ المسح الآن</button> -->
  <img id="startScan" width="40px" src="img/qr.png" alt="qrcode">
   <div id="reader" style="display:none;"></div>
   <button id="closeid"> اغلاق المسج (الكامراء) </button>

  <div id="result">النتيجة: -</div>

  <script>
    let html5QrCode;
    const readerDiv = document.getElementById('reader');
    const resultDiv = document.getElementById('result');
    const startBtn = document.getElementById('startScan');
    const closeid = document.getElementById('closeid');

    startBtn.addEventListener('click', async () => {
      startBtn.style.display = 'none';   // أخفِ الزر
      readerDiv.style.display = 'block'; // أظهر الماسح
      closeid.style.display = 'block';   // الكامراء أخفِ الزر

      // إنشاء كائن الماسح
      html5QrCode = new Html5Qrcode("reader");

      // الحصول على الكاميرات المتوفرة
      const cameras = await Html5Qrcode.getCameras();
      if (cameras && cameras.length) {
        const cameraId = cameras[2].id; // استخدم الكاميرا الأولى (الخلفية عادة على الجوال)
        html5QrCode.start(
          cameraId,
          { fps: 10, qrbox: 250 },
          (decodedText) => {
            // ✅ عند قراءة الكود بنجاح
            resultDiv.textContent = "النتيجة: " + decodedText;

            // أوقف الكاميرا فورًا
            html5QrCode.stop().then(() => {
              readerDiv.style.display = 'none';
              startBtn.style.display = 'inline-block';
            });

            // إرسال النتيجة إلى PHP
            fetch('process.php', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ qr: decodedText })
            })
            .then(r => r.text())
            .then(t => console.log('رد السيرفر:', t))
            .catch(err => console.error(err));
          },
          (errorMsg) => {
            // يمكن تجاهل أخطاء المسح المتكررة
          }
        ).catch(err => {
          alert("حدث خطأ في تشغيل الكاميرا: " + err);
        });
      } else {
        alert("لم يتم العثور على كاميرا!");
      }

              // تجريب عند الضغط على الكامراء يتم اغلاقها
closeid.onclick = function () {
    // أوقف الكاميرا فورًا
    html5QrCode.stop().then(() => {
       readerDiv.style.display = 'none';
       startBtn.style.display = 'inline-block';
     });
};
        
    });
  </script>  
          
          
        <div class="form-All marg-midai">

            <p> كلمة المرور <span>*</span></p>
            <form action="main.html" target="_self" class="form">
               <input type='password' id="password" class="input" style="display: block;" placeholder="اكتب كلمة المرور" >
                <div class="form-icon">
                    <div class="eyeIdex">
                        <i class="fa-sharp-duotone fa-solid fa-eye-slash bb" style="display: block;" id="eyeblock"></i>
                        <i class="fa-sharp-duotone fa-solid fa-eye bb" style="display: none;" id="eyenone"></i>
                    </div>
                </div>
        </div>
 
          <div class="submit-all marg-midai">
                <a href="#" class="a-pass">هل نسيت كلمة المرور؟</a>
                <input type="submit" id="save" class="save" value="تسجيل الدخول">
            </form>
            <div class="not-accunt marg-midai">
                <p>ليس لديك حساب؟</p>
                <a href="#">أنشاء حساب جديد</a>
            </div>
           </div>
      </div>
  </section>


<footer class="footer-log">
    <div class="sochail">
        <img src="img/logo.jpg" alt="logo">
        <img src="img/tdhamn.png" alt="logo">
        <img src="img/shar2.png" alt="logo">
    </div>
</footer>



    <script src="main_main.js"></script>

   
    
</body>
</html>

















